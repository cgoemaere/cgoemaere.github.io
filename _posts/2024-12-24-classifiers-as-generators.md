---
layout: post
title: "Classifiers as generators: ditch the softmax!"
head-extra: mathjax.html
---

This post was inspired by [Your Classifier is Secretly an Energy Based Model and You Should Treat it Like One](https://arxiv.org/abs/1912.03263). It made me rethink how image classifiers work—it’s much more nuanced than you might suspect.

Let's say you have an MNIST classifier $f$. For some wild reason, instead of classifying an image, you want to use it to _generate_ one. For example, a nice, clean image of a zero. How would you do it?

## Naive approach: direct input optimization on class probabilities
Here’s the obvious first attempt: you start with a random image $x = \text{torch.randn()}$ and a target class label $y = [1, 0, \dots, 0]$. Feed $x$ into $f$, calculate the loss (e.g., cross-entropy) between the predicted label $\hat y$​ and $y$, and backpropagate to update $x$ so it looks more “zero-like.” Repeat this process until $f$ confidently says that $x$ looks like a zero.

Sounds good, right? The problem is: it probably won't look like a zero to _you_!

![Naive approach to generating a 0 with an MNIST classifier](data:image/png;base64,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+TJsbW3LPF4ytpjREx4WLVokzsTHx4sz9evXF2cWLlwozjzzzDPiDAA899xz4syVK1fEmTlz5ogz+fn54gxgbIHVadOmiTO//PKLODN+/HhxJi4uTpwBjC1Y+fXXX4szRhZlTUlJEWd++ukncQYAxo4dK8688MIL4syuXbvEmZ49e4ozAKCUqvBMWcdzLTgiItKCBURERFqwgIiISAsWEBERacECIiIiLVhARESkBQuIiIi0YAEREZEWLCAiItKCBURERFqwgIiISAsWEBERaVHhX0hn1Jdffgk3N7cyjw8ODhZvw8iifICxBRQdHBzEmbfeekuc2bJlizhTr149cQaAoe94mjdvnjjz448/ijMdO3YUZwAgNjZWnHn33XfFmcaNG4szzs7O4kyrVq3EGcDYMX7u3DlxZty4ceJMnz59xJnw8HBxBgCioqLEmc6dO4sz0dHR4kyPHj3EGQB45ZVXxJljx46JxhcUFJRpHJ8BERGRFiwgIiLSggVERERasICIiEgLFhAREWnBAiIiIi1YQEREpAULiIiItGABERGRFiwgIiLSggVERERasICIiEgLFhAREWlho4wuCV1BMjMzYTKZ0KtXL9jb25c5Z2RF59DQUHEGAJo1aybO/Pzzz+LM/PnzxZnnn39enAkICBBnAGD06NHiTM2aNcUZIysFHzp0SJwBgNdff12ceeCBB8SZixcvijOBgYHizMCBA8UZAHB3dxdn8vLyxJnLly+LM/369RNnjKxYDgAuLi7izP79+8WZnJwccWbGjBniDAAcPHhQnImMjBSNv3r1Krp27Qqz2XzHY4nPgIiISAsWEBERacECIiIiLVhARESkBQuIiIi0YAEREZEWLCAiItKCBURERFqwgIiISAsWEBERacECIiIiLVhARESkRaVdjDQ1NVW0IOL169fF2xoyZIg4AwCfffaZONO8eXNxxsginF9//bU4Y2RBSMDYgpoffvihOBMXFyfOhISEiDOAscVSc3NzxRlXV1dxxsg/1ezsbHEGAGbPni3OGNl3o0aNEme2bNkiztSpU0ecAYCdO3eKM40bNxZn2rVrJ86sW7dOnAGAYcOGiTNnzpwRjc/Pz8f69eu5GCkREVVOLCAiItKCBURERFqwgIiISAsWEBERacECIiIiLVhARESkBQuIiIi0YAEREZEWLCAiItKCBURERFqwgIiISAs73RO4nQULFsDR0bHM49955x3xNjZs2CDOAIC/v78406xZM3HGxsZGnAkNDRVnfvzxR3EGAJydncWZpKQkcWbcuHHizH//+19xBgB+++03ccZsNoszBQUF4sz27dvFGSP7GwCCg4PFmaFDh4ozDRo0EGeMLBD6/fffizOAsYVwjfwukiy8XGzTpk3iDAA89dRT4syIESNE43NycrB+/fq7juMzICIi0oIFREREWogLaPfu3ejTpw/8/PxgY2NT4jsplFKYNWsWfH194ezsjLCwMJw6daq85ktERNWEuICys7PRtm1bxMbGlnr7woUL8c477+D999/H3r174eLigoiICOTk5PzlyRIRUfUhPgmhV69e6NWrV6m3KaWwePFivPTSS+jbty8A4KOPPoK3tzfWrVtn+BtIiYio+inX94BSUlKQlpaGsLAwy3UmkwkhISFISEgoNZObm4vMzEyrCxERVX/lWkBpaWkAAG9vb6vrvb29LbfdKiYmBiaTyXIxcoozERFVPdrPgouOjobZbLZczpw5o3tKRER0D5RrAfn4+AAA0tPTra5PT0+33HYrR0dHuLu7W12IiKj6K9cCCggIgI+Pj9UntjMzM7F371506NChPDdFRERVnPgsuKtXr1ot75GSkoIjR46gTp06aNCgASZPnoz58+ejadOmCAgIwMsvvww/Pz/069evPOdNRERVnLiADhw4gB49elh+njp1KoAbawXFxcVh+vTpyM7OxujRo5GRkYHOnTtj69atcHJyKr9ZExFRlWejlFK6J3GzzMxMmEwmjBw5Eg4ODmXONWnSRLytmJgYcQaAoQ/VvvDCC+KMkTMCmzZtKs4YWdwRAAIDA8WZunXrijNGFj397LPPxBkACAkJEWdat24tzhQWFooza9euFWdOnjwpzgDA8uXLxRkj/y4WL14sztSrV0+cMfLvAgD2798vzhh5tScxMVGc+de//iXOAMCTTz4pzmRlZYnG5+XlYdmyZTCbzXd8X1/7WXBERPT3xAIiIiItWEBERKQFC4iIiLRgARERkRYsICIi0oIFREREWrCAiIhICxYQERFpwQIiIiItWEBERKQFC4iIiLRgARERkRbir2O4V7KysmBvb1/m8ceOHRNvw8jqvQDg4eEhzvj5+Ykzhw4dEmfuv/9+cWbRokXiDGBsxenU1FRx5sSJE+JM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NXHGz89PnAGAffv2iTNvvvmmaHxRUVGZxvEZEBERacECIiIiLVhARESkBQuIiIi0YAEREZEWLCAiItKCBURERFqwgIiISAsWEBERacECIiIiLVhARESkBQuIiIi0sFFGVgOsQJmZmTCZTHjggQdga2tb5twTTzwh3tbAgQPFGQA4efKkOGNkwUqTySTO/PHHH+LM448/Ls4AwFdffSXOzJs3T5zp1KmTONO+fXtxBgBcXV3FmfDwcHFmwoQJ4szx48fFmdzcXHEGALy8vMSZ4OBgccbBwUGciYqKEmeki2kW27hxozhjZPHcFStWiDNubm7iDACcO3dOnJEuypqfn49NmzbBbDbD3d39tuP4DIiIiLRgARERkRYsICIi0oIFREREWrCAiIhICxYQERFpwQIiIiItWEBERKQFC4iIiLRgARERkRYsICIi0oIFREREWlTaxUh79OgBOzu7MueuXLki3taJEyfEGQBo0qSJOBMQECDODBo0SJz57bffxJkPP/xQnAGAl156SZwpLCwUZ9566y1xxshimgCwYMECcaZPnz7ijJOTkzjj5+cnzqxatUqcAYwdE7/88os4Y2Tx14KCAnFm3Lhx4gxgbOHTBx54QJyZP3++OFO7dm1xBgBmzZolzixcuFA0PjMzEx4eHlyMlIiIKicWEBERaSEqoJiYGDz00ENwc3ODl5cX+vXrV+K7cXJychAVFYW6devC1dUVAwcORHp6erlOmoiIqj5RAe3atQtRUVHYs2cPtm3bhvz8fISHhyM7O9syZsqUKdi4cSPi4+Oxa9cunD9/HgMGDCj3iRMRUdVW9nf5AWzdutXq57i4OHh5eeHgwYPo2rUrzGYzPvzwQ6xatQoPP/wwAGD58uW47777sGfPHvzjH/8ov5kTEVGV9pfeAzKbzQCAOnXqAAAOHjyI/Px8hIWFWca0aNECDRo0QEJCQqn3kZubi8zMTKsLERFVf4YLqKioCJMnT0anTp3QunVrAEBaWhocHBxQq1Ytq7He3t5IS0sr9X5iYmJgMpksF39/f6NTIiKiKsRwAUVFReHYsWP45JNP/tIEoqOjYTabLZczZ878pfsjIqKqQfQeULEJEyZg06ZN2L17N+rXr2+53sfHB3l5ecjIyLB6FpSeng4fH59S78vR0RGOjo5GpkFERFWY6BmQUgoTJkzAF198gW+//bbE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)\
*The disappointment of every ML student: classified as a zero with 99.9% certainty...*

## Why the naive approach fails: softmax normalization
There's only one reason this doesn't work: the softmax operation, which normalizes logits into probabilities.
Have you ever thought about what softmax does _exactly_? Here’s the breakdown:

Right before the final linear layer, the model has transformed the input image $x$ into a so-called _image embedding_. The weights $W$ of the linear layer act as a collection of class centroids (like in [K-means clustering](https://media.geeksforgeeks.org/wp-content/uploads/20190812011831/Screenshot-2019-08-12-at-1.09.42-AM.png)), where each column vector $W_i$​ represents such a centroid or “prototype” of class $i$ in feature space. The dot product between the image embedding $e$ and $W_i$​ gives a similarity score that tells you how likely it is that $x$ belongs to class $i$.[^0] But you probably know this similarity vector by the name _logits_.

Next, softmax bundles all these independent expert opinions by means of _normalization_. In a way, this is cheating: it assumes that $x$ must belong to one of the known classes. Normalization simply tries to find which class is the _most_ likely to match with the given image. For out-of-distribution images, this assumption no longer holds and the models seems to fail entirely.

For example: a rubbish image may get classified as a zero despite the 0-expert saying there's 1% chance it's a zero, simply because all other experts said there's less than 1% chance it's their class. Going back to the K-means clustering analogy, it's the same as finding the nearest centroid, without considering the actual distance to it.

Normalization effectively ignores whether any expert thinks the image is realistic. This is why optimization on class probabilities fails: softmax cares about relative confidence, not absolute plausibility.

## A classifier without softmax is just an energy-based model
To fix this, we need to stop relying on softmax probabilities and instead look at the raw logits. These logits give us two crucial pieces of information:
1.  How strongly the target expert thinks $x$ belongs to its class.
2.  How realistic the image is overall, regardless of class.

For point 2, we can use the LogSumExp to get an unnormalized estimate for $\log p(x)$, the data distribution. This works because every expert can be considered an energy-based model, with energy $E_{x,y_i} = -\text{logits}_i \propto -\log p(x \|y = i)$. Given that $p(x) = \sum_i  p(x \|y = i)$, we find that $\log p(x) = \log \sum_i \exp (-E_{x,y_i})$, or thus, the LogSumExp of the logits.

But wait, can a classifier do this out-of-the-box? It might seem that it's not trained to do this—but that's not true. You see, the matrix multiplication guarantees the independence of every expert $W_i$. And if all experts agree that $x$ is not in their class, we must conclude that $x$ lies outside the data distribution.

## Naive approach revisited: direct input optimization on _logits_
Let's take another look at our naive approach from the perspective of logits. Suppose we use a cross-entropy loss with a one-hot label at class $i$. Writing our loss in terms of logits, we find:\
$$\text{loss} = -\text{logits}_i  + \text{LogSumExp}(\text{logits})$$

Minimizing this loss means
1. Maximizing the logit from our desired class
2. Minimizing the LogSumExp(logits)

Notice that the second term _actively discourages_ realistic images! During training, this term makes sense: we want to push away all non-target experts. But for generation, this is clearly the wrong loss to optimize.

Let's make the simple modification of encouraging realistic images:\
$$\text{loss} = -\text{logits}_i  - \text{LogSumExp}(\text{logits})$$

Using this loss, we can finally generate a somewhat recognizable zero![^1]

![EBM_generated_zero](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaAAAAGzCAYAAABpdMNsAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjguMCwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy81sbWrAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAz1ElEQVR4nO3deXTV9Z3/8Vf2PZclO0sIe5GlJZUMgooSCVBttbZV60zBdhBt0CK1Kk4VtzMZacdSLaIznULbUau0da3aAwhYFVwQRFQwiUFASIBAdrLez+8PfrnjJQHy+ZrwSeLzcc49h9z7feX7ud/cmxd3yfuGGGOMAAA4w0JdLwAA8OVEAQEAnKCAAABOUEAAACcoIACAExQQAMAJCggA4AQFBABwggICADhBAQE9wJAhQzR37lzXywA6FQWELlVSUqIFCxZo5MiRio2NVWxsrMaMGaP8/Hxt377d9fI61Ysvvqi77rrL6RpCQkK0YMECp2sAOirc9QLQe73wwgu64oorFB4erquvvloTJkxQaGiodu7cqb/+9a9asWKFSkpKlJmZ6XqpneLFF1/U8uXLnZcQ0FNQQOgSxcXFuvLKK5WZmal169YpPT096PL7779fDz/8sEJDu++D8NraWsXFxbleBtBrdd97P3q0pUuXqra2VitXrmxTPpIUHh6uG2+8UYMGDQo6f+fOnfrOd76jfv36KTo6Wl//+tf13HPPBW2zatUqhYSE6PXXX9eiRYuUnJysuLg4XXbZZTp06FCbfb300ks699xzFRcXp4SEBH3jG9/QBx98ELTN3LlzFR8fr+LiYs2ePVsJCQm6+uqrJUn/+Mc/9N3vfleDBw9WVFSUBg0apJtuuknHjh0Lyi9fvlzS8afBWk+t/H6/li1bprPOOkvR0dFKTU3V/PnzdfTo0aB1GGN03333aeDAgYqNjdUFF1zQZq02NmzYoJCQED311FO6++67NWDAACUkJOg73/mOKisr1dDQoIULFyolJUXx8fG65ppr1NDQEPQ9Vq5cqQsvvFApKSmKiorSmDFjtGLFijb78vv9uuuuu5SRkRFY+4cfftju61cVFRVauHChBg0apKioKA0fPlz333+//H6/5+uKnodHQOgSL7zwgoYPH66cnJwOZz744ANNmTJFAwYM0G233aa4uDg99dRTuvTSS/WXv/xFl112WdD2N9xwg/r27aslS5Zo9+7dWrZsmRYsWKAnn3wysM0f//hHzZkzR3l5ebr//vtVV1enFStWaOrUqdq6dauGDBkS2La5uVl5eXmaOnWqfvnLXyo2NlaStHr1atXV1en6669X//799dZbb+mhhx7Svn37tHr1aknS/PnztX//fq1Zs0Z//OMf21y3+fPna9WqVbrmmmt04403qqSkRL/5zW+0detWvf7664qIiJAk3Xnnnbrvvvs0e/ZszZ49W++++65mzJihxsbGDh/H9hQUFCgmJka33XabioqK9NBDDykiIkKhoaE6evSo7rrrLm3evFmrVq1SVlaW7rzzzkB2xYoVOuuss/TNb35T4eHhev755/XjH/9Yfr9f+fn5ge0WL16spUuX6pJLLlFeXp7ee+895eXlqb6+PmgtdXV1Ov/88/XZZ59p/vz5Gjx4sN544w0tXrxYBw4c0LJly77QdUUPYoBOVllZaSSZSy+9tM1lR48eNYcOHQqc6urqApdNnz7djBs3ztTX1wfO8/v95pxzzjEjRowInLdy5UojyeTm5hq/3x84/6abbjJhYWGmoqLCGGNMdXW16dOnj5k3b17QGkpLS43P5ws6f86cOUaSue2229qs+fNrbFVQUGBCQkLMp59+GjgvPz/ftHeX+sc//mEkmcceeyzo/Jdffjno/IMHD5rIyEjzjW98I+h63X777UaSmTNnTpvvfSJJJj8/P/D1+vXrjSQzduxY09jYGDj/qquuMiEhIWbWrFlB+cmTJ5vMzMzTXv+8vDwzdOjQwNelpaUmPDy8zc/8rrvuarP2e++918TFxZmPP/44aNvbbrvNhIWFmT179pz2eqJ34Ck4dLqqqipJUnx8fJvLpk2bpuTk5MCp9WmrI0eO6JVXXtH3vvc9VVdX6/Dhwzp8+LDKy8uVl5enwsJCffbZZ0Hf69prrw16muvcc89VS0uLPv30U0nSmjVrVFFRoauuuirw/Q4fPqywsDDl5ORo/fr1bdZ3/fXXtzkvJiYm8O/a2lodPnxY55xzjowx2rp162mPx+rVq+Xz+XTRRRcFrSM7O1vx8fGBdaxdu1aNjY264YYbgq7XwoULT7uP0/nBD34QeJQlSTk5OTLG6Ic//GHQdjk5Odq7d6+am5sD533++ldWVurw4cM6//zz9cknn6iyslKStG7dOjU3N+vHP/5x0Pe74YYb2qxl9erVOvfcc9W3b9+g45Gbm6uWlha9+uqrX/j6omfgKTh0uoSEBElSTU1Nm8seffRRVVdXq6ysTP/8z/8cOL+oqEjGGN1xxx2644472v2+Bw8e1IABAwJfDx48OOjyvn37SlLgdZXCwkJJ0oUXXtju90tMTAz6Ojw8XAMHDmyz3Z49e3TnnXfqueeea/OaTesv4FMpLCxUZWWlUlJS2r384MGDkhQozhEjRgRdnpycHLhuXp14rHw+nyS1eQ3O5/PJ7/ersrJS/fv3lyS9/vrrWrJkiTZt2qS6urqg7SsrK+Xz+QJrHz58eNDl/fr1a7P2wsJCbd++XcnJye2utfV4oPejgNDpfD6f0tPTtWPHjjaXtb4mtHv37qDzW198vvnmm5WXl9fu9z3xl1tYWFi725n//ynzrd/zj3/8o9LS0tpsFx4efPOPiopq8668lpYWXXTRRTpy5IhuvfVWjR49WnFxcfrss880d+7cDr1o7vf7lZKSoscee6zdy0/2i7gznexYne4YFhcXa/r06Ro9erQeeOABDRo0SJGRkXrxxRf1q1/9ytObBvx+vy666CLdcsst7V4+cuRI6++JnokCQpf4xje+od/+9rd66623NGnSpNNuP3ToUElSRESEcnNzO2UNw4YNkySlpKR4/p7vv/++Pv74Y/3+97/XD37wg8D5a9asabPt5582O3Eda9eu1ZQpU4KezjpR699DFRYWBo6HJB06dKjNI68z5fnnn1dDQ4Oee+65oEdRJz592br2oqIiZWVlBc4vLy9vs/Zhw4appqam037O6Ll4DQhd4pZbblFsbKx++MMfqqysrM3lrf/DbpWSkqJp06bp0Ucf1YEDB9ps397bq08nLy9PiYmJ+vd//3c1NTV5+p6tjxA+v15jjH7961+32bb1b4YqKiqCzv/e976nlpYW3XvvvW0yzc3Nge1zc3MVERGhhx56KGh/Lt8V1t71r6ys1MqVK4O2mz59usLDw9u8Pfs3v/lNm+/5ve99T5s2bdLf//73NpdVVFQEvf6E3o1HQOgSI0aM0OOPP66rrrpKo0aNCkxCMMaopKREjz/+uEJDQ4Nec1m+fLmmTp2qcePGad68eRo6dKjKysq0adMm7du3T++9957VGhITE7VixQr9y7/8iyZOnKgrr7xSycnJ2rNnj/72t79pypQp7f6C/LzRo0dr2LBhuvnmm/XZZ58pMTFRf/nLX9p9RJKdnS1JuvHGG5WXl6ewsDBdeeWVOv/88zV//nwVFBRo27ZtmjFjhiIiIlRYWKjVq1fr17/+tb7zne8oOTlZN998swoKCnTxxRdr9uzZ2rp1q1566SUlJSVZXffOMmPGDEVGRuqSSy7R/PnzVVNTo//+7/9WSkpK0H8UUlNT9ZOf/ET/+Z//qW9+85uaOXOm3nvvvcDaP//o8Gc/+5mee+45XXzxxZo7d66ys7NVW1ur999/X3/+85+1e/duZ9cXZ5ijd9/hS6KoqMhcf/31Zvjw4SY6OtrExMSY0aNHm+uuu85s27atzfbFxcXmBz/4gUlLSzMRERFmwIAB5uKLLzZ//vOfA9u0vg377bffDsq2vuV4/fr1bc7Py8szPp/PREdHm2HDhpm5c+ead955J7DNnDlzTFxcXLvX4cMPPzS5ubkmPj7eJCUlmXnz5pn33nvPSDIrV64MbNfc3GxuuOEGk5ycbEJCQtq8Jfu//uu/THZ2tomJiTEJCQlm3Lhx5pZbbjH79+8PbNPS0mLuvvtuk56ebmJiYsy0adPMjh07TGZm5hd6G/bq1auDtjvZMVyyZImRZA4dOhQ477nnnjPjx4830dHRZsiQIeb+++83v/vd74wkU1JSEnT977jjDpOWlmZiYmLMhRdeaD766CPTv39/c9111wXtp7q62ixevNgMHz7cREZGmqSkJHPOOeeYX/7yl0FvF0fvFmLMCc+FAEAnqaioUN++fXXffffp3/7t31wvB90MrwEB6BSfH03UqvX1q2nTpp3ZxaBH4DUgAJ3iySef1KpVqzR79mzFx8frtdde0xNPPKEZM2ZoypQprpeHbogCAtApxo8fr/DwcC1dulRVVVWBNybcd999rpeGborXgAAATvAaEADACQoIAOBEt3sNyO/3a//+/UpISDjpaBMAQPdljFF1dbUyMjJO+anH3a6A9u/f32ZCLwCg59m7d2+7E+ZbdbsCah3lv2LFilMObjxR6zh4G58f+Gjjo48+ss5MnDjROlNcXGydOdnI/1OJjIy0zkjyNLPrxE/H7Aib20GrE6dtd9TnB2l2VFFRkXVmzJgx1hkvH819qjv/qXh5b5KXn5OX/ZSWllpnvPLySbStn6Rro71ZhacTHR1tnZFOPgH9VFo/46uj6uvrde+99wZ+n59MlxXQ8uXL9Ytf/EKlpaWaMGGCHnrooQ5NRW592i0mJsbqB+nlh+HlhnIm9+XlDu1lP2eygLw8rerlOnm9c56pfZ2p/Xi5DUneisHLdfKyHy/HwevT+ad6+uhkvBxzL6Xg9WfrZV9ePxL+dMe9S96E8OSTT2rRokVasmSJ3n33XU2YMEF5eXl80BQAIKBLCuiBBx7QvHnzdM0112jMmDF65JFHFBsbq9/97nddsTsAQA/U6QXU2NioLVu2BH3YVGhoqHJzc7Vp06Y22zc0NKiqqiroBADo/Tq9gA4fPqyWlhalpqYGnZ+amtrui4cFBQXy+XyBE++AA4AvB+d/iLp48WJVVlYGTnv37nW9JADAGdDp74JLSkpSWFhYm49hLisrU1paWpvto6KiFBUV1dnLAAB0c53+CCgyMlLZ2dlat25d4Dy/369169Zp8uTJnb07AEAP1SV/B7Ro0SLNmTNHX//61zVp0iQtW7ZMtbW1uuaaa7pidwCAHqhLCuiKK67QoUOHdOedd6q0tFRf/epX9fLLL7d5YwIA4MuryyYhLFiwQAsWLPCcDw0NtforZJ/PZ72Po0ePWmcktfta1um899571pnBgwdbZ2pqaqwzXiYaSFJycrJ1pqSkxDrzla98xTrjZbSJJFVXV1tnvIy72bVrl3XGy6QBr3/B7uW+4WVqQHx8vHUmLi7OOuPl5ypJffr0sc588skn1pnhw4dbZ7yM3ZK8jXSy1dH7n/N3wQEAvpwoIACAExQQAMAJCggA4AQFBABwggICADhBAQEAnKCAAABOUEAAACcoIACAExQQAMAJCggA4ESXDSM907x8lLff7/e0r/r6euvMoUOHrDNehhpmZ2dbZ4qKiqwzkrRnzx7rzMSJE60zO3futM6MHTvWOiNJR44cOSMZLx/C6GUw5v79+60zkjRq1CjrzO7du60zXoayJiUlWWeMMdYZSYqJibHOePnZehnSW1FRYZ2RvA0xDQkJsdr+2LFjHdqOR0AAACcoIACAExQQAMAJCggA4AQFBABwggICADhBAQEAnKCAAABOUEAAACcoIACAExQQAMAJCggA4AQFBABwottOw25sbFR4eMeX19Hpq5/X0tJinZGkuro664yXCblDhgyxznz22WfWmaysLOuMJG3evNk607dvX+uMz+ezznid8J2cnGyd8XKdvEwyrqqqss54mWrtlZfbuJf7YE1NjXVm8ODB1hmvOS8ZL8fB6zTsxMRE60xpaanV9o2NjR3ajkdAAAAnKCAAgBMUEADACQoIAOAEBQQAcIICAgA4QQEBAJyggAAATlBAAAAnKCAAgBMUEADACQoIAOBEtx1G2tDQoNDQjvdjeXm59T78fr91RpKys7OtMwcPHrTOFBYWWme8DBbduXOndUaSBg4caJ3x8nNqbm62zvTv3986I3kbahsTE2OdiY2Ntc54GYLr9WdbXV1tnTnnnHOsMxMmTLDOrF+/3jqzb98+64zkbdCszRDlVnFxcdYZL0NZve6ro8NFbbfnERAAwAkKCADgBAUEAHCCAgIAOEEBAQCcoIAAAE5QQAAAJyggAIATFBAAwAkKCADgBAUEAHCCAgIAONFth5Hu379f0dHRHd7ey2DM0tJS64wkFRcXW2f69etnnRk1apR1xsuA1dTUVOuMJDU1NVlnBg8ebJ3xMnTR68/Wy8/Jy/BJLw4fPmydaWho8LSvAQMGWGfKysqsM2+//bZ1ZtasWdaZoqIi64wkbdmyxTozZswY60x9fb11JjMz0zojebtv2A7p7ej14REQAMAJCggA4ESnF9Bdd92lkJCQoNPo0aM7ezcAgB6uS568Puuss7R27dr/28kZeo4cANBzdEkzhIeHKy0trSu+NQCgl+iS14AKCwuVkZGhoUOH6uqrr9aePXtOum1DQ4OqqqqCTgCA3q/TCygnJ0erVq3Syy+/rBUrVqikpETnnnvuST9jvqCgQD6fL3AaNGhQZy8JANANdXoBzZo1S9/97nc1fvx45eXl6cUXX1RFRYWeeuqpdrdfvHixKisrA6e9e/d29pIAAN1Ql787oE+fPho5cuRJ/xAsKipKUVFRXb0MAEA30+V/B1RTU6Pi4mKlp6d39a4AAD1IpxfQzTffrI0bN2r37t164403dNlllyksLExXXXVVZ+8KANCDdfpTcPv27dNVV12l8vJyJScna+rUqdq8ebOSk5M7e1cAgB6s0wvoT3/6U6d8H5/Pp5iYmA5v72UQYlhYmHVGkqc3ShhjrDONjY1nJJOYmGidkaSKigrrjJfj0NzcbJ3JyMiwzkjeBqx6+UNrL0NCvTyNHRcXZ52RpAMHDlhnbO6vrUaMGGGdeeutt6wzOTk51hlJeu+996wz27dvt85ERkZaZ2bMmGGdkbzdb7Oysqy2r6ur69B2zIIDADhBAQEAnKCAAABOUEAAACcoIACAExQQAMAJCggA4AQFBABwggICADhBAQEAnKCAAABOUEAAACe6/APpvCovL7f6oDovQzinTJlinZG8DfMrKSmxzmRmZlpnvAyR9DIYU/I26DI2NtY6U1paap3x+/3WGUlKSkqyznR08OLnxcfHW2c+++wz64zXz+HyMrxz6dKl1plx48ZZZz7++GPrzKxZs6wzknTxxRdbZ44cOWKd8TL09JNPPrHOSFJCQoJ1xvZ33rFjxzq0HY+AAABOUEAAACcoIACAExQQAMAJCggA4AQFBABwggICADhBAQEAnKCAAABOUEAAACcoIACAExQQAMAJCggA4ES3nYbdp08fRUdHd3h7L1OWd+zYYZ2RvE0Y7t+/v3XGy0Tnjk6h/Twv03G97qulpcU6M3r0aOuMl8nRkqxuc62qqqqsM14mJg8dOtQ6U1xcbJ2RpE8//dQ686//+q/WmX379llnzjrrLOtMbW2tdUaSCgsLrTOhofb/r/eyPi9T2CUpMTHRU85GR+/nPAICADhBAQEAnKCAAABOUEAAACcoIACAExQQAMAJCggA4AQFBABwggICADhBAQEAnKCAAABOUEAAACe67TDSiIgIRUZGdnh7n89nvY+jR49aZyTpk08+sc4MGzbMOlNRUWGdGTJkiHVm586d1hnp+M/IVkpKinXmww8/tM4MHDjQOiNJYWFh1pnk5GTrzO7du60zu3btss6cc8451hlJWrdunXXmueees87ceOON1pkHH3zQOjNlyhTrjORteG5SUpJ1Ji8vzzrz7LPPWmckKTs72zpjOzS2vr6+Q9vxCAgA4AQFBABwggICADhBAQEAnKCAAABOUEAAACcoIACAExQQAMAJCggA4AQFBABwggICADhBAQEAnOi2w0gTExMVExPT4e2rqqqs9zFu3DjrjCQdOXLEOnPw4EHrTGio/f8PbI5Zq6lTp1pnJG/H3EsmMzPTOuN1wOrXvvY168yhQ4esM5WVldaZwsJC68zQoUOtM5Lk9/utM+Xl5dYZL7dxL9LS0jzliouLrTNvvPGGdSY3N9c6k56ebp2RvP0uGj16tNX2dXV1HdqOR0AAACcoIACAE9YF9Oqrr+qSSy5RRkaGQkJC9MwzzwRdbozRnXfeqfT0dMXExCg3N9fTUwcA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odu9CQEA8OXQox4BAQB6DwoIAOAEBQQAcIICAgA4QQEBAJzoMQW0fPlyDRkyRNHR0crJydFbb73lekln3F133aWQkJCg0+jRo10vq8u9+uqruuSSS5SRkaGQkBA988wzQZcbY3TnnXcqPT1dMTExys3NVWFhoZvFdqHTHYe5c+e2uX3MnDnTzWK7SEFBgc4++2wlJCQoJSVFl156qXbt2hW0TX19vfLz89W/f3/Fx8fr8ssvV1lZmaMVd42OHIdp06a1uT1cd911jlbcvh5RQE8++aQWLVqkJUuW6N1339WECROUl5engwcPul7aGXfWWWfpwIEDgdNrr73mekldrra2VhMmTNDy5cvbvXzp0qV68MEH9cgjj+jNN99UXFyc8vLyPE/E7q5OdxwkaebMmUG3jyeeeOIMrrDrbdy4Ufn5+dq8ebPWrFmjpqYmzZgxI2hC9k033aTnn39eq1ev1saNG7V//359+9vfdrjqzteR4yBJ8+bNC7o9LF261NGKT8L0AJMmTTL5+fmBr1taWkxGRoYpKChwuKozb8mSJWbChAmul+GUJPP0008Hvvb7/SYtLc384he/CJxXUVFhoqKizBNPPOFghWfGicfBGGPmzJljvvWtbzlZjysHDx40kszGjRuNMcd/9hEREWb16tWBbT766CMjyWzatMnVMrvcicfBGGPOP/9885Of/MTdojqg2z8Camxs1JYtW5Sbmxs4LzQ0VLm5udq0aZPDlblRWFiojIwMDR06VFdffbX27NnjeklOlZSUqLS0NOj24fP5lJOT86W8fWzYsEEpKSkaNWqUrr/+epWXl7teUpeqrKyUJPXr10+StGXLFjU1NQXdHkaPHq3Bgwf36tvDiceh1WOPPaakpCSNHTtWixcvPqOfm9YR3W4a9okOHz6slpYWpaamBp2fmpqqnTt3OlqVGzk5OVq1apVGjRqlAwcO6O6779a5556rHTt2KCEhwfXynCgtLZWkdm8frZd9WcycOVPf/va3lZWVpeLiYt1+++2aNWuWNm3apLCwMNfL63R+v18LFy7UlClTNHbsWEnHbw+RkZHq06dP0La9+fbQ3nGQpO9///vKzMxURkaGtm/frltvvVW7du3SX//6V4erDdbtCwj/Z9asWYF/jx8/Xjk5OcrMzNRTTz2lH/3oRw5Xhu7gyiuvDPx73LhxGj9+vIYNG6YNGzZo+vTpDlfWNfLz87Vjx44vxeugp3Ky43DttdcG/j1u3Dilp6dr+vTpKi4u1rBhw870MtvV7Z+CS0pKUlhYWJt3sZSVlSktLc3RqrqHPn36aOTIkSoqKnK9FGdabwPcPtoaOnSokpKSeuXtY8GCBXrhhRe0fv36oM8PS0tLU2NjoyoqKoK27623h5Mdh/bk5ORIUre6PXT7AoqMjFR2drbWrVsXOM/v92vdunWaPHmyw5W5V1NTo+LiYqWnp7teijNZWVlKS0sLun1UVVXpzTff/NLfPvbt26fy8vJedfswxmjBggV6+umn9corrygrKyvo8uzsbEVERATdHnbt2qU9e/b0qtvD6Y5De7Zt2yZJ3ev24PpdEB3xpz/9yURFRZlVq1aZDz/80Fx77bWmT58+prS01PXSzqif/vSnZsOGDaakpMS8/vrrJjc31yQlJZmDBw+6XlqXqq6uNlu3bjVbt241kswDDzxgtm7daj799FNjjDH/8R//Yfr06WOeffZZs337dvOtb33LZGVlmWPHjjleeec61XGorq42N998s9m0aZMpKSkxa9euNRMnTjQjRoww9fX1rpfeaa6//nrj8/nMhg0bzIEDBwKnurq6wDbXXXedGTx4sHnllVfMO++8YyZPnmwmT57scNWd73THoaioyNxzzz3mnXfeMSUlJebZZ581Q4cONeedd57jlQfrEQVkjDEPPfSQGTx4sImMjDSTJk0ymzdvdr2kM+6KK64w6enpJjIy0gwYMMBcccUVpqioyPWyutz69euNpDanOXPmGGOOvxX7jjvuMKmpqSYqKspMnz7d7Nq1y+2iu8CpjkNdXZ2ZMWOGSU5ONhERESYzM9PMmzev1/0nrb3rL8msXLkysM2xY8fMj3/8Y9O3b18TGxtrLrvsMnPgwAF3i+4CpzsOe/bsMeedd57p16+fiYqKMsOHDzc/+9nPTGVlpduFn4DPAwIAONHtXwMCAPROFBAAwAkKCADgBAUEAHCCAgIAOEEBAQCcoIAAAE5QQAAAJyggAIATFBAAwAkKCADgxP8DPiUoNC2Z4xoAAAAASUVORK5CYII=)\
*An insanely realistic image that's 100% a zero—according to $f$, at least*

## New problem: sampling from an energy-based model
Even after all this trouble, there’s still one major challenge left: even with $\log p(x)$, optimizing $x$ for maximum likelihood doesn’t necessarily give us realistic samples. Instead, we need to sample from the _typical set_, the region of high probability mass. What does that mean? How do we do this exactly? That story leads us into the territory of denoising diffusion models and their sampler schedules—so I'll leave it at that, for now. But for the curious minds, I can already highly recommend [this blogpost from Sander Dieleman on typicality](https://sander.ai/2020/09/01/typicality.html).

## Conclusion
Your classifier isn’t just a probability predictor; it’s secretly a collection of energy-based models, burried under a softmax. By treating it as such, we gain a much deeper understanding of what the model is actually doing. With a dead-simple modification to the loss, we can turn the classifier into a generator, to produce images that are not just classified correctly but also look realistic. A humble reminder that solutions come easy to those who truly understand the problem.

---
**Food for thought:** I suspect adversarial attacks make use of the exact same mechanism. I wonder how it looks like under the LogSumExp lens!

___
[^0]: In this dot product, the vectors $e$ and $W_i$ are not necessarily normalized. In fact, the norm of $W_i$ can be used to model the prior probability of the class, together with the bias term $b_i$. In fact, this is true for _all_ linear operations, and led to techniques like [Weight Normalization](https://arxiv.org/abs/1602.07868) which model this weight norm as a separate parameter, thereby improving the training stability.
[^1]: This will only work well for models with continuous gradients. Replace the discontinuities (e.g., ReLU, MaxPooling) with continuous alternatives (e.g., SoftPlus, AveragePooling). Since we're dealing with inverse optimization here (trying to find an image that matches a class label), it's also best to use bijective operations.
